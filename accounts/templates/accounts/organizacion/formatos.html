{% extends 'accounts/base_dashboard.html' %}
{% load static %}
{% block title %}Términos y Avisos de Privacidad{% endblock %}
{% block header %}Términos y Avisos de Privacidad{% endblock %}
{% block content %}

<!-- SECCIÓN DE TÍTULO ENCABEZANDO -->
<div class="row">
     <div class="col">
          <h1 class="text-center">Formatos de la organización</h1>
          <hr />
     </div>
</div>
<div class="container mt-5">
     <ul class="nav nav-tabs">
          <li class="nav-item">
               <a class="nav-link active" href="#organizacion" data-bs-toggle="tab">Organización</a>
          </li>
          <li class="nav-item">
               <a class="nav-link " href="#cotizaciones" data-bs-toggle="tab">Cotizaciones</a>
          </li>
          <li class="nav-item">
               <a class="nav-link" href="#ordenes" data-bs-toggle="tab">Órdenes de Trabajo</a>
          </li>
          <li class="nav-item">
               <a class="nav-link" href="#sistema" data-bs-toggle="tab">Configuracion del sistema</a>
          </li>
     </ul>

     <div class="tab-content">

          <div class="tab-pane fade show active" id="organizacion">
               <div class="row">
                    <div class="col">
                         <h2 class="mt-3">Organizacion</h2>
                    </div>
                    <div class="col mt-4 text-end">
                         <a href="{% url 'cargar_csd' %}" class="btn btn-primary">Carga Certificado de Sellos Dijitales</a>
                    </div>
                    
               </div>
               
               <form method="post" enctype="multipart/form-data">  <!-- Añade enctype si usas archivos -->
                    {% csrf_token %}
                    {{ form.as_p }}  <!-- Imprime el formulario de organización una vez -->
                    <div class="text-end m-5">
                        <button type="submit" name="guardar_organizacion" class="btn btn-success">Guardar organización</button>
                    </div>
                </form>
          </div>

          <div class="tab-pane fade show" id="cotizaciones">
               <h2 class="mt-3">Cotizaciones</h2>
               <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="row">
                         <div class="col-md-4">
                              {% if formato_cotizacion.imagen_marca_agua %}
                                   <h4>Marca de agua:</h4>
                                   <div style="border: 1px solid #ddd; padding: 10px; margin-bottom: 15px;">
                                        <img src="{{ formato_cotizacion.imagen_marca_agua.url }}" alt="Marca de agua"
                                             style="max-width: 100%; height: auto;">
                                   </div>
                              {% else %}
                                   <code>No se ha subido ninguna imagen de marca de agua.</code>
                              {% endif %}
                         </div>
                         <div class="col">
                              {{ formato_cotizacion_form.as_p }}
                         </div>
                    </div>
                    <div class="text-end m-5">
                         <button type="submit" name="guardar_cotizacion" class="btn btn-success">Guardar Cotización</button>
                         <!-- Ejemplo de botón -->
                         <a href="{% url 'cotizacion_prueba' %}" class="btn btn-primary">Generar Cotización de Prueba Formato Acutal</a>
                    </div>
               </form>
          </div>

          <div class="tab-pane fade" id="ordenes">
               <h2 class="mt-3">Órdenes de Trabajo</h2>
               <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="row">
                         <div class="col-md-4">
                              {% if formato_orden.imagen_marca_agua %}
                                   <h4>Marca de agua:</h4>
                                   <div style="border: 1px solid #ddd; padding: 10px; margin-bottom: 15px;">
                                        <img src="{{ formato_orden.imagen_marca_agua.url }}" alt="Marca de agua"
                                             style="max-width: 100%; height: auto;">
                                   </div>
                              {% else %}
                                   <code>No se ha subido ninguna imagen de marca de agua.</code>
                              {% endif %}
                         </div>
                         <div class="col">
                              {{ formato_orden_form.as_p }}
                         </div>
                    </div>
                    <div class="text-end m-5">
                         <button type="submit" name="guardar_orden" class="btn btn-success">Guardar Orden</button>
                    </div>
                    
               </form>
          </div>

          <div class="tab-pane fade" id="sistema">
               <h2 class="mt-3">Configuración del Sistema</h2>
               <form method="post" novalidate>
                    {% csrf_token %}
                    <div class="mb-3">
                         <label for="moneda_predeterminada" class="form-label">Moneda Predeterminada</label>
                         {{ forms.moneda_predeterminada }}
                    </div>
                    <div class="mb-3">
                         <label for="tasa_iva_default" class="form-label">Tasa de IVA Predeterminada</label>
                         {{ forms.tasa_iva_default }}
                    </div>
                    <div class="mb-3">
                         <label for="formato_numero_cotizacion" class="form-label">Formato de Número de Cotización</label>
                         {{ forms.formato_numero_cotizacion }}
                    </div>
                    <div class="text-end m-5">
                         <button type="submit" name="guardar_sistema" class="btn btn-success">Guardar configuracion de sistema</button>
                    </div>
               </form>
          </div>
     </div>
</div>
{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
     const swalWithBootstrapButtons = Swal.mixin({
          customClass: {
               confirmButton: "btn btn-success",
               cancelButton: "btn btn-danger"
          },
     });
     swalWithBootstrapButtons.fire({
          title: "Estas seguro?",
          text: "No podras revertir los cambios!",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          confirmButtonText: "Si, seguro!",
          cancelButtonText: "No, cancelar!",

     }).then((result) => {
          if (result.isConfirmed) {
          } else if (result.dismiss === Swal.DismissReason.cancel) {
               // Redirigir a la página de inicio cuando se cancela
               window.location.href = "{% url 'home' %}"; // Cambia esta URL por la de tu página de inicio
          }
     });
</script>
{% endblock %}
{% endblock %}